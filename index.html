<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>ì„±ì‹¤ ë ˆë²¨ ì—… í”„ë¡œì íŠ¸ â€” PWA</title>
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#0f172a">
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <style>
    html,body{height:100%}
    .card{ border-radius:1rem; border:1px solid #e2e8f0; background:#fff; box-shadow:0 1px 2px rgba(0,0,0,.04); }
    .btn{ display:inline-flex; align-items:center; justify-content:center; padding:.5rem .75rem; border-radius:.75rem; border:1px solid #cbd5e1; background:#fff; }
    .btn:hover{ background:#f8fafc }
    .btn-primary{ background:#0f172a; color:#fff; border-color:#0f172a }
    .btn-ghost{ border-color:transparent }
    .input{ width:100%; border:1px solid #cbd5e1; border-radius:.75rem; padding:.5rem .75rem }
    .label{ font-size:.75rem; color:#475569 }
    .switch{ width:38px; height:22px }
    .switch input{ display:none }
    .switch span{ display:block; width:100%; height:100%; background:#e2e8f0; border-radius:9999px; position:relative; transition:.2s }
    .switch span:after{ content:''; position:absolute; top:2px; left:2px; width:18px; height:18px; background:#fff; border-radius:9999px; transition:.2s; box-shadow:0 1px 2px rgba(0,0,0,.2) }
    .switch input:checked + span{ background:#0f172a }
    .switch input:checked + span:after{ transform:translateX(16px) }
    .pixelate{ image-rendering: pixelated }
  </style>
</head>
<body class="min-h-full bg-gradient-to-b from-slate-50 to-white text-slate-900 p-4 md:p-8">
  <div id="root"></div>

  <script>
    if ("serviceWorker" in navigator) {
      window.addEventListener("load", () => {
        navigator.serviceWorker.register("./sw.js").catch(()=>{});
      });
    }
  </script>

  <script type="text/babel">
    const CATEGORIES = ['ë‹¤ì´ì–´íŠ¸','ê·¸ë¦¼','ì½”ë”©/ìê²©ì¦','ì˜ì–´','ìƒí™œ êµì–‘','ì±… ì“°ê¸°','ìƒí™œ ìŠµê´€'];
    const LS_KEY = 'diligence-level-up-app.v1';
    const fmtDate = d => new Date(d).toISOString().slice(0,10);
    const todayStr = fmtDate(new Date());
    const defaultWeeklyGoals = [
      { category: 'ê·¸ë¦¼', targetCount: 5, achievedCount: 0 },
      { category: 'ì½”ë”©/ìê²©ì¦', targetCount: 4, achievedCount: 0 },
      { category: 'ì˜ì–´', targetCount: 5, achievedCount: 0 },
      { category: 'ë‹¤ì´ì–´íŠ¸', targetCount: 5, achievedCount: 0 },
      { category: 'ìƒí™œ ìŠµê´€', targetCount: 4, achievedCount: 0 },
      { category: 'ìƒí™œ êµì–‘', targetCount: 2, achievedCount: 0 },
      { category: 'ì±… ì“°ê¸°', targetCount: 2, achievedCount: 0 },
    ];
    const defaultInventory = () => ({
      fragments: { 'íƒì‹ì˜ ë§ˆë„ì„œ':0, 'í™˜ì‹ì˜ ê³„ì•½ì„œ':0, 'í˜„ìì˜ ë³´ê¸‰ ì£¼ë¬¸ì„œ':0, 'ì†Œë§ì˜ ê²°ì •':0 },
      items: { 'íƒì‹ì˜ ë§ˆë„ì„œ':0, 'í™˜ì‹ì˜ ê³„ì•½ì„œ':0, 'í˜„ìì˜ ë³´ê¸‰ ì£¼ë¬¸ì„œ':0, 'ì†Œë§ì˜ ê²°ì •':0 },
    });
    const seedMissions = () => ([
      { id: crypto.randomUUID(), title:'ìœ ì‚°ì†Œ ìš´ë™ 40ë¶„', category:'ë‹¤ì´ì–´íŠ¸', plannedXp:40, done:false, pixelate:true },
      { id: crypto.randomUUID(), title:'í¬ë¡œí‚¤ 2ì¥', category:'ê·¸ë¦¼', plannedXp:35, done:false, pixelate:true },
      { id: crypto.randomUUID(), title:'C ê°•ì˜ 1ê°•', category:'ì½”ë”©/ìê²©ì¦', plannedXp:30, done:false },
      { id: crypto.randomUUID(), title:'ì˜ë‹¨ì–´ ì•”ê¸° 30ë¶„', category:'ì˜ì–´', plannedXp:25, done:false },
    ]);
    const clamp01 = x => Math.max(0, Math.min(1, x));
    const percent = n => Math.round(n*100);
    const xpForMission = (m, rates) => {
      const base = Number(m.plannedXp)||0;
      const extra = m.isExtra ? base * rates.extraMissionRate : base;
      return m.done ? extra : base * rates.xpPenaltyRate;
    };
    const save = (s) => localStorage.setItem(LS_KEY, JSON.stringify(s));
    const load = () => { try { const raw = localStorage.getItem(LS_KEY); return raw ? JSON.parse(raw) : null } catch { return null } };

    function App(){
      const [state, setState] = React.useState(() => load() ?? ({
        profile: { level: 8, xp: 309, nextLevelXp: 700 },
        weekNumber: 7,
        weeklyGoals: defaultWeeklyGoals,
        days: { [todayStr]: { date: todayStr, missions: seedMissions(), settled:false, dayXpAwarded:0 } },
        inventory: defaultInventory(),
        settings: { xpPenaltyRate:0.5, extraMissionRate:0.6, minibossRewardFragments:1, locale:'ko-KR' },
        quickNote: ''
      }));
      const [selectedDate, setSelectedDate] = React.useState(todayStr);

      React.useEffect(()=>{ save(state); }, [state]);

      const day = React.useMemo(()=> state.days[selectedDate] ?? { date:selectedDate, missions:[], settled:false, dayXpAwarded:0 }, [state, selectedDate]);

      React.useEffect(()=>{
        if(!state.days[selectedDate]){
          setState(prev=> ({...prev, days:{...prev.days, [selectedDate]: { date:selectedDate, missions:[], settled:false, dayXpAwarded:0 } }}));
        }
      }, [selectedDate]);

      const completionRate = React.useMemo(()=>{
        const total = day.missions.length || 1;
        const done = day.missions.filter(m=>m.done).length;
        return done/total;
      }, [day.missions]);

      const minibossChance = percent(clamp01(completionRate * 1.2));

      function addMission(partial={}){
        const m = { id:crypto.randomUUID(), title:'ìƒˆ ë¯¸ì…˜', category:'ìƒí™œ ìŠµê´€', plannedXp:20, done:false, ...partial };
        setState(prev=> ({...prev, days:{...prev.days, [selectedDate]: {...day, missions:[...day.missions, m] }}}));
      }
      function updateMission(id, patch){
        setState(prev=> ({...prev, days:{...prev.days, [selectedDate]: {...day, missions: day.missions.map(m=> m.id===id? {...m, ...patch}: m) }}}));
      }
      function removeMission(id){
        setState(prev=> ({...prev, days:{...prev.days, [selectedDate]: {...day, missions: day.missions.filter(m=>m.id!==id) }}}));
      }
      function settleDay(){
        if(day.settled) return;
        const { xpPenaltyRate, extraMissionRate } = state.settings;
        const awarded = Math.round(day.missions.reduce((s,m)=> s + xpForMission(m,{xpPenaltyRate, extraMissionRate}), 0));
        let level = state.profile.level;
        let xp = state.profile.xp + awarded;
        let next = state.profile.nextLevelXp;
        while(xp >= next){ xp -= next; level += 1; next = Math.round(next * 1.25); }
        const chance = minibossChance;
        const success = Math.random()*100 < chance;
        const inv = JSON.parse(JSON.stringify(state.inventory));
        if(success){
          const keys = ['íƒì‹ì˜ ë§ˆë„ì„œ','í™˜ì‹ì˜ ê³„ì•½ì„œ','í˜„ìì˜ ë³´ê¸‰ ì£¼ë¬¸ì„œ','ì†Œë§ì˜ ê²°ì •'];
          const k = keys[Math.floor(Math.random()*keys.length)];
          inv.fragments[k] += state.settings.minibossRewardFragments;
          for(const key of keys){ while(inv.fragments[key] >= 5){ inv.fragments[key]-=5; inv.items[key]+=1; } }
        }
        const inc = {}; day.missions.filter(m=>m.done).forEach(m=>{ inc[m.category] = (inc[m.category]||0)+1; });
        const newWeekly = state.weeklyGoals.map(g=> ({...g, achievedCount: g.achievedCount + (inc[g.category]||0)}));
        const newDay = { ...day, settled:true, dayXpAwarded: awarded, minibossResult: success? 'ì„±ê³µ':'ì‹¤íŒ¨', minibossChance: chance };
        setState(prev=> ({...prev, profile:{level, xp, nextLevelXp:next}, days:{...prev.days, [selectedDate]: newDay}, weeklyGoals:newWeekly, inventory:inv }));
      }
      function resetWeek(){ if(!confirm('ì´ë²ˆ ì£¼ ì§„í–‰ë„ë¥¼ 0ìœ¼ë¡œ ì´ˆê¸°í™”í• ê¹Œìš”?')) return; setState(prev=> ({...prev, weekNumber: prev.weekNumber+1, weeklyGoals: prev.weeklyGoals.map(g=>({...g, achievedCount:0})) })); }
      function weeklyRewardInfo(){ return state.weeklyGoals.every(g=> g.achievedCount >= g.targetCount) ? 'ì£¼ê°„ ë³´ìƒ ì¡°ê±´ ë‹¬ì„±! (ì „ í•­ëª© ë‹¬ì„±)' : 'ë¶€ë¶„ ë‹¬ì„±: ë³´ìƒ ì—†ìŒ'; }
      function exportData(){ const blob = new Blob([JSON.stringify(state,null,2)], {type:'application/json'}); const url = URL.createObjectURL(blob); const a=document.createElement('a'); a.href=url; a.download=`ì„±ì‹¤ë ˆë²¨ì—…_${state.weekNumber}ì£¼ì°¨_${selectedDate}.json`; a.click(); URL.revokeObjectURL(url);}
      function importData(file){ const r = new FileReader(); r.onload=()=>{ try{ const s=JSON.parse(String(r.result)); setState(s); alert('ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì™”ì–´ìš”!'); }catch{ alert('ê°€ì ¸ì˜¤ê¸° ì‹¤íŒ¨: JSON í˜•ì‹ ì˜¤ë¥˜'); } }; r.readAsText(file); }

      const weekProgress = state.weeklyGoals.reduce((acc,g)=>{ acc.total += g.targetCount; acc.current += Math.min(g.achievedCount, g.targetCount); return acc; }, {total:0, current:0});

      return (
        <div className="max-w-6xl mx-auto grid gap-6">
          <div className="flex items-center justify-between gap-3">
            <div className="flex items-center gap-3">
              <div className="text-2xl">âœ¨</div>
              <h1 className="text-2xl md:text-3xl font-bold">ì„±ì‹¤ ë ˆë²¨ ì—… í”„ë¡œì íŠ¸ (PWA)</h1>
              <span className="px-2 py-1 rounded-xl bg-slate-100 text-slate-700 text-sm">{state.weekNumber}ì£¼ì°¨</span>
            </div>
            <div className="flex items-center gap-2">
              <button className="btn" onClick={exportData}>â¬‡ï¸ ë‚´ë³´ë‚´ê¸°</button>
              <label className="btn cursor-pointer">â¬†ï¸ ê°€ì ¸ì˜¤ê¸°
                <input type="file" accept="application/json" className="hidden" onChange={e=>{ const f=e.target.files?.[0]; if(f) importData(f); }}/>
              </label>
            </div>
          </div>

          <div className="grid md:grid-cols-3 gap-4">
            <div className="card p-4">
              <div className="text-lg font-semibold mb-3">ğŸ›¡ï¸ í”„ë¡œí•„</div>
              <div className="grid grid-cols-3 gap-3 items-end">
                <div>
                  <div className="label">ë ˆë²¨</div>
                  <input className="input" type="number" value={state.profile.level} onChange={e=> setState(p=>({...p, profile:{...p.profile, level:Number(e.target.value)}}))} />
                </div>
                <div>
                  <div className="label">ê²½í—˜ì¹˜</div>
                  <input className="input" type="number" value={state.profile.xp} onChange={e=> setState(p=>({...p, profile:{...p.profile, xp:Number(e.target.value)}}))} />
                </div>
                <div>
                  <div className="label">ë‹¤ìŒ ë ˆë²¨ í•„ìš”ì¹˜</div>
                  <input className="input" type="number" value={state.profile.nextLevelXp} onChange={e=> setState(p=>({...p, profile:{...p.profile, nextLevelXp:Number(e.target.value)}}))} />
                </div>
              </div>
            </div>

            <div className="card p-4">
              <div className="text-lg font-semibold mb-3">ğŸ“… ì˜¤ëŠ˜</div>
              <div className="grid gap-3">
                <div className="flex items-center gap-2">
                  <input className="input" type="date" value={selectedDate} onChange={e=> setSelectedDate(e.target.value)} />
                  <button className="btn" onClick={()=> setSelectedDate(todayStr)}>ì˜¤ëŠ˜</button>
                </div>
                <div className="flex items-center justify-between">
                  <div className="text-sm text-slate-600">ë‹¬ì„±ë¥ </div>
                  <div className="text-lg font-semibold">{percent(completionRate)}%</div>
                </div>
                <div className="h-2 bg-slate-200 rounded-xl overflow-hidden"><div className="h-full bg-slate-900" style={{width:`${percent(completionRate)}%`}}/></div>
                <div className="flex items-center justify-between">
                  <div className="text-sm text-slate-600">ë¯¸ë‹ˆë³´ìŠ¤ ìŠ¹ë¥ </div>
                  <div className="text-lg font-semibold">{minibossChance}%</div>
                </div>
                {day.settled ? (
                  <div className="text-sm text-emerald-700 bg-emerald-50 border border-emerald-200 rounded-xl p-2">
                    ì •ì‚° ì™„ë£Œ â€¢ íšë“ XP {day.dayXpAwarded} â€¢ ë¯¸ë‹ˆë³´ìŠ¤ {day.minibossResult} ({day.minibossChance}%)
                  </div>
                ) : (
                  <button className="btn btn-primary w-full" onClick={settleDay}>ğŸ—¡ï¸ í•˜ë£¨ ë Â· ì •ì‚°</button>
                )}
              </div>
            </div>

            <div className="card p-4">
              <div className="text-lg font-semibold mb-3">ğŸ† ì£¼ê°„ ì§„í–‰</div>
              <div className="space-y-3">
                <div className="text-sm text-slate-600">ì£¼ê°„ ì¢…í•© ì§„í–‰ë¥ </div>
                <div className="h-2 bg-slate-200 rounded-xl overflow-hidden"><div className="h-full bg-slate-900" style={{width:`${percent(weekProgress.current/Math.max(1,weekProgress.total))}%`}}/></div>
                <div className="text-sm">{weekProgress.current} / {weekProgress.total}</div>
                <div className="text-sm font-medium">{weeklyRewardInfo()}</div>
                <button className="btn" onClick={resetWeek}>ì£¼ì°¨ ë§ˆê° & ì´ˆê¸°í™”</button>
              </div>
            </div>
          </div>

          <Tabs
            tabs={[
              { key:'missions', label:'ì˜¤ëŠ˜ì˜ ë¯¸ì…˜', content: <Missions day={day} state={state} addMission={addMission} updateMission={updateMission} removeMission={removeMission} /> },
              { key:'weekly', label:'ì£¼ê°„ ëª©í‘œ', content: <Weekly state={state} setState={setState} /> },
              { key:'inventory', label:'ì¸ë²¤í† ë¦¬', content: <InventoryPanel state={state} setState={setState} /> },
              { key:'recommend', label:'ì¶”ì²œ ë¯¸ì…˜', content: <Recommended onAdd={addMission} /> },
              { key:'settings', label:'ì„¤ì •', content: <Settings state={state} setState={setState} /> },
            ]}
          />

          <div className="text-center text-xs text-slate-500 py-6">Â© {new Date().getFullYear()} ì„±ì‹¤ ë ˆë²¨ ì—… í”„ë¡œì íŠ¸ Â· PWA</div>
        </div>
      );
    }

    function Tabs({tabs}){
      const [active, setActive] = React.useState(tabs[0]?.key);
      return (
        <div className="w-full">
          <div className="grid grid-cols-5 border rounded-xl overflow-hidden">
            {tabs.map(t=> (
              <button key={t.key} className={"px-3 py-2 text-sm " + (active===t.key? 'bg-slate-900 text-white':'bg-white hover:bg-slate-50')} onClick={()=> setActive(t.key)}>{t.label}</button>
            ))}
          </div>
          <div className="mt-4 card p-4">
            {tabs.find(t=>t.key===active)?.content}
          </div>
        </div>
      );
    }

    function Missions({day, state, addMission, updateMission, removeMission}){
      const { settings } = state;
      return (
        <div className="space-y-3">
          {day.missions.length===0 && <div className="text-sm text-slate-500">ë¯¸ì…˜ì´ ì—†ìŠµë‹ˆë‹¤. ì•„ë˜ ë²„íŠ¼ìœ¼ë¡œ ì¶”ê°€í•´ ë³´ì„¸ìš”.</div>}
          {day.missions.map(m=> (
            <div key={m.id} className="border rounded-xl p-3 grid md:grid-cols-12 gap-2 items-center">
              <div className="md:col-span-3">
                <input className="input" aria-label="ë¯¸ì…˜ ì œëª©" value={m.title} onChange={e=> updateMission(m.id, {title:e.target.value})} />
              </div>
              <div className="md:col-span-2">
                <select className="input" value={m.category} onChange={e=> updateMission(m.id, {category:e.target.value})}>
                  {CATEGORIES.map(c=> <option key={c} value={c}>{c}</option>)}
                </select>
              </div>
              <div className="md:col-span-2 flex items-end gap-2">
                <div className="flex-1">
                  <div className="label">ì˜ˆì • XP</div>
                  <input className="input" type="number" value={m.plannedXp} onChange={e=> updateMission(m.id, {plannedXp:Number(e.target.value)})} />
                </div>
                <label className="switch mt-6">
                  <input type="checkbox" checked={!!m.isExtra} onChange={e=> updateMission(m.id, {isExtra:e.target.checked})} />
                  <span></span>
                </label>
                <span className="text-xs">ì¶”ê°€</span>
              </div>
              <div className="md:col-span-3">
                <textarea className="input" rows="2" placeholder="ë©”ëª¨" value={m.notes||''} onChange={e=> updateMission(m.id, {notes:e.target.value})}></textarea>
                <div className="grid grid-cols-5 gap-2 mt-2 items-end">
                  <div className="col-span-3">
                    <div className="label">ì´ë¯¸ì§€ URL</div>
                    <input className="input" placeholder="https://..." value={m.imageUrl||''} onChange={e=> updateMission(m.id, {imageUrl:e.target.value})} />
                  </div>
                  <label className="col-span-2 flex items-center gap-2">
                    <span className="label">í”½ì…€ì•„íŠ¸ ëª¨ë“œ</span>
                    <span className="switch"><input type="checkbox" checked={!!m.pixelate} onChange={e=> updateMission(m.id, {pixelate:e.target.checked})} /><span></span></span>
                  </label>
                </div>
              </div>
              <div className="md:col-span-2 flex items-center justify-end gap-2">
                <button className={"btn " + (m.done? 'btn-primary':'')} onClick={()=> updateMission(m.id, {done: !m.done})}>{m.done? 'âœ… ì™„ë£Œ':'â€¦ ë¯¸ì™„ë£Œ'}</button>
                <button className="btn btn-ghost" onClick={()=> removeMission(m.id)}>ğŸ—‘ï¸</button>
              </div>
              {m.imageUrl && (
                <div className="md:col-span-12">
                  <img src={m.imageUrl} alt="ë¯¸ì…˜ ì´ë¯¸ì§€" className={"w-full max-h-64 object-contain border rounded-xl " + (m.pixelate? 'pixelate':'')} />
                </div>
              )}
              <div className="md:col-span-12 text-xs text-slate-600 pt-1">
                ì •ì‚° ì˜ˆìƒ XP: {Math.round(xpForMission(m, { extraMissionRate: settings.extraMissionRate, xpPenaltyRate: settings.xpPenaltyRate }))}
              </div>
            </div>
          ))}
          <div className="flex gap-2">
            <button className="btn" onClick={()=> addMission()}>â• ìƒˆ ë¯¸ì…˜ ë§Œë“¤ê¸°</button>
            <button className="btn" onClick={()=> addMission({ title:'ì˜ë‹¨ì–´ ë³µìŠµ', category:'ì˜ì–´', plannedXp:20, pixelate:true })}>í…œí”Œë¦¿: ì˜ì–´ ë³µìŠµ</button>
            <button className="btn" onClick={()=> addMission({ title:'í¬ë¡œí‚¤ 2ì¥', category:'ê·¸ë¦¼', plannedXp:35, pixelate:true })}>í…œí”Œë¦¿: í¬ë¡œí‚¤</button>
          </div>
        </div>
      );
    }

    function Weekly({state, setState}){
      return (
        <div className="space-y-4">
          {state.weeklyGoals.map((g,i)=> (
            <div key={g.category} className="border rounded-xl p-3 grid md:grid-cols-12 items-center gap-3">
              <div className="md:col-span-3 font-medium">{g.category}</div>
              <div className="md:col-span-3 flex items-end gap-2">
                <div className="flex-1">
                  <div className="label">ëª©í‘œ íšŸìˆ˜</div>
                  <input className="input" type="number" value={g.targetCount} onChange={e=>{
                    const v = Number(e.target.value);
                    setState(p=> ({...p, weeklyGoals: p.weeklyGoals.map((x,idx)=> idx===i? {...x, targetCount:v}: x)}));
                  }} />
                </div>
                <div className="flex-1">
                  <div className="label">ë‹¬ì„±(ëˆ„ì )</div>
                  <input className="input" type="number" value={g.achievedCount} onChange={e=>{
                    const v = Number(e.target.value);
                    setState(p=> ({...p, weeklyGoals: p.weeklyGoals.map((x,idx)=> idx===i? {...x, achievedCount:v}: x)}));
                  }} />
                </div>
              </div>
              <div className="md:col-span-6">
                <div className="h-2 bg-slate-200 rounded-xl overflow-hidden"><div className="h-full bg-slate-900" style={{width:`${Math.round(Math.min(1, g.achievedCount/Math.max(1,g.targetCount))*100)}%`}}/></div>
              </div>
            </div>
          ))}
          <div className="text-xs text-slate-600">* ì£¼ê°„ ëª©í‘œëŠ” "í•˜ë£¨ ë" ì •ì‚° ì‹œì—ë§Œ ìë™ ì¦ê°€í•©ë‹ˆë‹¤. (ìˆ˜ë™ ì¡°ì •ë„ ê°€ëŠ¥)</div>
        </div>
      );
    }

    function InventoryPanel({state, setState}){
      const keys = Object.keys(state.inventory.fragments);
      return (
        <div className="grid md:grid-cols-2 gap-4">
          <div className="card p-4">
            <div className="text-base font-semibold mb-2">ğŸ² ì¡°ê°</div>
            <div className="space-y-2">
              {keys.map(k=> (
                <div key={k} className="flex items-center justify-between">
                  <div>{k}</div>
                  <div className="flex items-center gap-2">
                    <span className="px-2 py-1 rounded-xl bg-slate-100">{state.inventory.fragments[k]}ê°œ</span>
                    <button className="btn" onClick={()=>{
                      setState(p=>{
                        const inv = JSON.parse(JSON.stringify(p.inventory));
                        inv.fragments[k] += 1;
                        while(inv.fragments[k] >= 5){ inv.fragments[k]-=5; inv.items[k]+=1; }
                        return {...p, inventory: inv};
                      });
                    }}>+1</button>
                  </div>
                </div>
              ))}
            </div>
          </div>
          <div className="card p-4">
            <div className="text-base font-semibold mb-2">âœ¨ ì™„ì„± ì•„ì´í…œ</div>
            <div className="space-y-2">
              {Object.keys(state.inventory.items).map(k=> (
                <div key={k} className="flex items-center justify-between">
                  <div>{k}</div>
                  <span className="px-2 py-1 rounded-xl bg-slate-100">{state.inventory.items[k]}ê°œ</span>
                </div>
              ))}
            </div>
          </div>
          <div className="text-xs text-slate-600 md:col-span-2">* ë¯¸ë‹ˆë³´ìŠ¤ ìŠ¹ë¦¬ ì‹œ ë¬´ì‘ìœ„ ì¡°ê° 1ê°œ íšë“. ì¡°ê° 5ê°œê°€ ë˜ë©´ ìë™ìœ¼ë¡œ í•©ì„±ë©ë‹ˆë‹¤.</div>
        </div>
      );
    }

    function Recommended({onAdd}){
      const templates = [
        { title:'í¬ë¡œí‚¤ 2ì¥', category:'ê·¸ë¦¼', plannedXp:35, pixelate:true, hint:'7ì£¼ì°¨ ëª©í‘œ 5íšŒ' },
        { title:'ìœ ì‚°ì†Œ ìš´ë™ 40ë¶„', category:'ë‹¤ì´ì–´íŠ¸', plannedXp:40, pixelate:true, hint:'ì£¼ 5íšŒ ë£¨í‹´' },
        { title:'36ì‹œê°„ ë‹¨ì‹ ì¤€ë¹„/íšŒë³µê¸°ë¡', category:'ë‹¤ì´ì–´íŠ¸', plannedXp:25, hint:'ì£¼ 2íšŒ' },
        { title:'ìŠ¤ë§ˆíŠ¸í° ë””í†¡ìŠ¤ 3ì‹œê°„', category:'ìƒí™œ ìŠµê´€', plannedXp:30, hint:'ì£¼ 3íšŒ' },
        { title:'ì˜ë‹¨ì–´ ì•”ê¸° 30ë¶„', category:'ì˜ì–´', plannedXp:25, pixelate:true, hint:'ì£¼ 5íšŒ' },
        { title:'ì˜ì–´ ì˜ìƒ ì‹œì²­ 20ë¶„', category:'ì˜ì–´', plannedXp:20, hint:'ì£¼ 3íšŒ' },
        { title:'C ì–¸ì–´ ê°•ì˜ 1ê°•', category:'ì½”ë”©/ìê²©ì¦', plannedXp:30, hint:'ì§„ë„ ë§ˆë¬´ë¦¬' },
        { title:'í”½ì…€ ì•„íŠ¸ ê°•ì˜ 1ê°•', category:'ê·¸ë¦¼', plannedXp:28, pixelate:true, hint:'ì£¼ 3íšŒ' },
        { title:'ì¸ì²´ ë“œë¡œì‰ ì±… ë³µìŠµ', category:'ê·¸ë¦¼', plannedXp:22, pixelate:true },
        { title:'ë…ì„œ 30ìª½', category:'ìƒí™œ êµì–‘', plannedXp:20, hint:'ë§ˆì˜ì‚°/ê±¸ë¦¬ë²„' },
        { title:'ì¹´ë“œë‰´ìŠ¤ 3ê°œ', category:'ìƒí™œ êµì–‘', plannedXp:15 },
      ];
      return (
        <div className="grid md:grid-cols-2 gap-3">
          {templates.map((t,i)=> (
            <div key={i} className="card p-4 flex items-center justify-between">
              <div>
                <div className="font-medium">âœ¨ {t.title}</div>
                {t.hint && <div className="text-sm text-slate-600">{t.hint}</div>}
                <div className="text-xs text-slate-600 mt-1">ì¹´í…Œê³ ë¦¬: {t.category}</div>
              </div>
              <div className="flex items-center gap-2">
                <span className="px-2 py-1 rounded-xl bg-slate-100">XP {t.plannedXp}</span>
                <button className="btn btn-primary" onClick={()=> onAdd(t)}>ë‹´ê¸°</button>
              </div>
            </div>
          ))}
        </div>
      );
    }

    function Settings({state, setState}){
      const s = state.settings;
      return (
        <div className="grid md:grid-cols-2 gap-4">
          <div className="border rounded-xl p-3 space-y-3">
            <div className="grid grid-cols-2 gap-2 items-end">
              <div>
                <div className="label">ì‹¤íŒ¨ í˜ë„í‹°(%)</div>
                <input className="input" type="number" value={Math.round(s.xpPenaltyRate*100)} onChange={e=> setState(p=>({...p, settings:{...p.settings, xpPenaltyRate: Number(e.target.value)/100 }}))} />
              </div>
              <div>
                <div className="label">ì¶”ê°€ ë¯¸ì…˜ ë³´ìƒ(%)</div>
                <input className="input" type="number" value={Math.round(s.extraMissionRate*100)} onChange={e=> setState(p=>({...p, settings:{...p.settings, extraMissionRate: Number(e.target.value)/100 }}))} />
              </div>
            </div>
            <div className="grid grid-cols-2 gap-2 items-end">
              <div>
                <div className="label">ë¯¸ë‹ˆë³´ìŠ¤ ì¡°ê° ë³´ìƒ</div>
                <input className="input" type="number" value={s.minibossRewardFragments} onChange={e=> setState(p=>({...p, settings:{...p.settings, minibossRewardFragments: Number(e.target.value) }}))} />
              </div>
              <div>
                <div className="label">í‘œì‹œ ë¡œì¼€ì¼</div>
                <input className="input" value={s.locale} onChange={e=> setState(p=>({...p, settings:{...p.settings, locale: e.target.value }}))} />
              </div>
            </div>
            <div className="flex items-center justify-between pt-2">
              <button className="btn" onClick={()=> { localStorage.removeItem(LS_KEY); setState({
                profile: { level: 8, xp: 309, nextLevelXp: 700 },
                weekNumber: 7,
                weeklyGoals: defaultWeeklyGoals,
                days: { [todayStr]: { date: todayStr, missions: seedMissions(), settled:false, dayXpAwarded:0 } },
                inventory: defaultInventory(),
                settings: { xpPenaltyRate:0.5, extraMissionRate:0.6, minibossRewardFragments:1, locale:'ko-KR' },
                quickNote: ''
              }); }}>ëª¨ë‘ ì´ˆê¸°í™”</button>
              <div className="text-xs text-slate-500">ë¸Œë¼ìš°ì €ì— ìë™ ì €ì¥ë©ë‹ˆë‹¤.</div>
            </div>
          </div>

          <div className="border rounded-xl p-3 space-y-3">
            <div className="text-sm font-medium">ë¹ ë¥¸ ë©”ëª¨</div>
            <textarea className="input" rows="8" placeholder="ê·¸ë‚ ì˜ ì»¨ë””ì…˜, ê¹¨ë‹¬ìŒ, íšŒê³  ë“±ì„ ê¸°ë¡í•˜ì„¸ìš”." value={state.quickNote} onChange={e=> setState(p=> ({...p, quickNote: e.target.value}))}></textarea>
          </div>
        </div>
      );
    }

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App/>);
  </script>
</body>
</html>